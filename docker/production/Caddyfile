# =============================================
# CADDYFILE - Reverse Proxy con SSL automatico
# =============================================
# Caddy v2.x - Modifica example.com con il tuo dominio

example.com {
    # =========================================
    # REVERSE PROXY
    # =========================================
    # Inoltra tutte le richieste a WordPress
    reverse_proxy wordpress:80

    # =========================================
    # COMPRESSIONE GZIP
    # =========================================
    encode gzip zstd

    # =========================================
    # SECURITY HEADERS
    # =========================================
    header {
        # Previene il MIME type sniffing
        X-Content-Type-Options nosniff

        # Protezione XSS (browser moderni)
        X-XSS-Protection "1; mode=block"

        # Impedisce embedding in iframe (clickjacking)
        X-Frame-Options DENY

        # Referrer Policy
        Referrer-Policy strict-origin-when-cross-origin

        # Strict Transport Security (HSTS)
        # Forza HTTPS per 1 anno
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

        # Content Security Policy base
        # Modifica secondo le tue esigenze
        # Content-Security-Policy "default-src 'self'"

        # Rimuove header che espongono info server
        -Server
        -X-Powered-By
    }

    # =========================================
    # LOGGING
    # =========================================
    log {
        output file /var/log/caddy/access.log {
            roll_size 10mb
            roll_keep 5
        }
    }
}

# =========================================
# REDIRECT WWW â†’ NON-WWW
# =========================================
www.example.com {
    redir https://example.com{uri} permanent
}
